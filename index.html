<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>주요 도시 5일 날씨 예보</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    background: #eef6f9;
  }
  h1 { text-align: center; }
  select, input[type=submit] {
    font-size: 1rem;
    padding: 8px 12px;
    margin: 10px 5px;
  }
  #map {
    height: 500px;
    margin-top: 20px;
    border-radius: 10px;
    box-shadow: 0 3px 7px rgba(0,0,0,0.2);
  }
  .forecast {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
  }
  .day {
    background: white;
    border-radius: 12px;
    box-shadow: 0 3px 7px rgba(0,0,0,0.1);
    margin: 10px;
    padding: 15px;
    width: 140px;
    text-align: center;
  }
  .day h3 { margin: 0 0 8px 0; }
  .day strong { color: #e63946; font-size: 1.2rem; }
  .humidity { color: #1d3557; font-weight: 600; margin: 6px 0 0 0; }
  .error { color: red; margin-top: 20px; }
</style>
</head>

<body>
  <h1>주요 도시 5일 날씨 예보 </h1>

  <form id="weatherForm">
    <select id="citySelect" required>
      <option value="">도시 선택</option>
      <option value="1835848">Seoul, KR</option>
      <option value="5128581">New York, US</option>
      <option value="2643743">London, GB</option>
      <option value="1850147">Tokyo, JP</option>
      <option value="2950159">Berlin, DE</option>
      <option value="2147714">Sydney, AU</option>
      <option value="1880252">Singapore, SG</option>
      <option value="3435910">Buenos Aires, AR</option>
      <option value="3448439">São Paulo, BR</option>
      <option value="360630">Cairo, EG</option>
      <option value="3117735">Madrid, ES</option>
      <option value="2988507">Paris, FR</option>
      <option value="993800">Johannesburg, ZA</option>
      <option value="6167865">Toronto, CA</option>
      <option value="1816670">Beijing, CN</option>
      <option value="2643123">Manchester, GB</option>
      <option value="3451190">Rio de Janeiro, BR</option>
      <option value="2673730">Stockholm, SE</option>
    </select>
    <input type="submit" value="검색" />
  </form>

  <div id="forecastResult" class="forecast"></div>
  <div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const API_KEY = '66f62464dec4a29271b61021e3858e76';  // OpenWeatherMap API 키

// 주요 도시 목록 (id + 좌표)
const cities = [
  { id: 1835848, name: "Seoul", lat: 37.5665, lon: 126.9780 },
  { id: 5128581, name: "New York", lat: 40.7128, lon: -74.0060 },
  { id: 2643743, name: "London", lat: 51.5074, lon: -0.1278 },
  { id: 1850147, name: "Tokyo", lat: 35.6895, lon: 139.6917 },
  { id: 2950159, name: "Berlin", lat: 52.52, lon: 13.405 },
  { id: 2147714, name: "Sydney", lat: -33.8688, lon: 151.2093 },
  { id: 1880252, name: "Singapore", lat: 1.3521, lon: 103.8198 },
  { id: 3435910, name: "Buenos Aires", lat: -34.6037, lon: -58.3816 },
  { id: 3448439, name: "São Paulo", lat: -23.5505, lon: -46.6333 },
  { id: 360630, name: "Cairo", lat: 30.0444, lon: 31.2357 },
  { id: 3117735, name: "Madrid", lat: 40.4168, lon: -3.7038 },
  { id: 2988507, name: "Paris", lat: 48.8566, lon: 2.3522 },
  { id: 993800, name: "Johannesburg", lat: -26.2041, lon: 28.0473 },
  { id: 6167865, name: "Toronto", lat: 43.6532, lon: -79.3832 },
  { id: 1816670, name: "Beijing", lat: 39.9042, lon: 116.4074 },
  { id: 2643123, name: "Manchester", lat: 53.4808, lon: -2.2426 },
  { id: 3451190, name: "Rio de Janeiro", lat: -22.9068, lon: -43.1729 },
  { id: 2673730, name: "Stockholm", lat: 59.3293, lon: 18.0686 }


  
];

// 지도 초기화
const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18,
}).addTo(map);

// 지도 마커 추가
cities.forEach(city => {
  const marker = L.marker([city.lat, city.lon]).addTo(map);
  marker.bindTooltip(city.name);

  marker.on('click', () => {
    fetchForecast(city.id);
  });
});

document.getElementById('weatherForm').addEventListener('submit', e => {
  e.preventDefault();
  const cityId = document.getElementById('citySelect').value;
  if (!cityId) {
    alert('도시를 선택해주세요!');
    return;
  }
  fetchForecast(cityId);
});

function fetchForecast(cityId) {
  const url = `https://api.openweathermap.org/data/2.5/forecast?id=${cityId}&appid=${API_KEY}&units=metric&lang=kr`;
  fetch(url)
    .then(res => res.json())
    .then(data => {
      if (data.cod === "200") {
        showForecast(data);
        // 지도 중심 이동
        map.setView([data.city.coord.lat, data.city.coord.lon], 6);
        // 팝업 표시
        const icon = data.list[0].weather[0].icon;
        const desc = data.list[0].weather[0].description;
        const temp = data.list[0].main.temp.toFixed(1);
        L.popup()
          .setLatLng([data.city.coord.lat, data.city.coord.lon])
          .setContent(`
            <h3>${data.city.name}</h3>
            <img src="https://openweathermap.org/img/wn/${icon}.png">
            <p><strong>${temp} ℃</strong><br>${desc}</p>
          `)
          .openOn(map);
      } else {
        document.getElementById('forecastResult').innerHTML = `<p class="error">도시 정보를 찾을 수 없습니다.</p>`;
      }
    })
    .catch(err => {
      console.error(err);
      document.getElementById('forecastResult').innerHTML = `<p class="error">오류가 발생했습니다.</p>`;
    });
}

function showForecast(data){
  const daily = {};
  data.list.forEach(item => {
    const date = item.dt_txt.split(' ')[0];
    if(!daily[date]) daily[date] = { temps: [], humidities: [], descriptions: [], icons: [] };
    daily[date].temps.push(item.main.temp);
    daily[date].humidities.push(item.main.humidity);
    daily[date].descriptions.push(item.weather[0].description);
    daily[date].icons.push(item.weather[0].icon);
  });
  
  const days = Object.keys(daily).slice(0,5);
  let html = '';
  days.forEach(date => {
    const day = daily[date];
    const avgTemp = (day.temps.reduce((a,b) => a+b, 0) / day.temps.length).toFixed(1);
    const avgHumidity = (day.humidities.reduce((a,b) => a+b, 0) / day.humidities.length).toFixed(0);
    const desc = mostFrequent(day.descriptions);
    const icon = mostFrequent(day.icons);
    const dateObj = new Date(date);
    const dateStr = `${dateObj.getMonth()+1}/${dateObj.getDate()} (${['일','월','화','수','목','금','토'][dateObj.getDay()]})`;
    
    html += `
      <div class="day">
        <h3>${dateStr}</h3>
        <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${desc}">
        <strong>${avgTemp} ℃</strong>
        <p class="humidity">습도: ${avgHumidity}%</p>
        <p>${desc}</p>
      </div>
    `;
  });
  
  document.getElementById('forecastResult').innerHTML = html;
}

function mostFrequent(arr){
  const count = {};
  arr.forEach(v => count[v] = (count[v] || 0) + 1);
  return Object.keys(count).reduce((a,b) => count[a] > count[b] ? a : b);
}
</script>
</body>
</html>


