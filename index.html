<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ğŸŒ¦ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
/* ... (ê¸°ì¡´ CSS ìŠ¤íƒ€ì¼ ìœ ì§€) ... */
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: linear-gradient(to bottom, #e8f7ff, #f7fbff); transition: background 0.5s; }
h1 { text-align: center; }
.controls { text-align: center; margin-bottom: 10px; }
select, input[type=submit], button { font-size: 1rem; padding: 8px 12px; margin: 10px 5px; border-radius: 8px; border: 1px solid #ccc; background: white; cursor: pointer; transition: background 0.2s; }
select:hover, input[type=submit]:hover, button:hover { background: #dff4ff; }
#map { height: 480px; margin-top: 20px; border-radius: 10px; box-shadow: 0 3px 7px rgba(0,0,0,0.2); }
.forecast { margin-top: 25px; display: flex; justify-content: center; flex-wrap: wrap; }
.day { background: white; border-radius: 12px; box-shadow: 0 3px 7px rgba(0,0,0,0.1); margin: 10px; padding: 15px; width: 200px; text-align: center; opacity: 0; transform: translateY(20px); animation: fadeInUp 0.6s forwards; cursor: pointer; transition: transform 0.2s; }
.day:hover { transform: scale(1.05); }
.day h3 { margin: 0 0 6px 0; }
.day strong { color: #e63946; font-size: 1.2rem; }
.humidity, .wind, .pressure { font-size: 0.9rem; color: #1d3557; margin: 4px 0; }
.error { color: red; text-align: center; margin-top: 20px; }
#loading { text-align: center; font-size: 1.1rem; color: #333; margin-top: 20px; }
@keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
@media (max-width: 600px) { .day { width: 100%; max-width: 280px; } }
.modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
.modal-content { background: white; border-radius: 10px; padding: 20px; max-width: 600px; width: 90%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
.modal-close { float: right; cursor: pointer; font-weight: bold; font-size: 1.2rem; }

/* ë¡œê·¸ì¸ í™”ë©´ ìŠ¤íƒ€ì¼ */
#loginScreen {
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #f7fbff;
    z-index: 1000;
    flex-direction: column;
    text-align: center;
}
#loginBox {
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
#passwordInput {
    padding: 10px;
    margin: 15px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 1.1rem;
    width: 200px;
    text-align: center;
}
#loginButton {
    background-color: #4a90e2;
    color: white;
    border: none;
}
#loginButton:hover {
    background-color: #357abd;
}
</style>
</head>
<body>

<div id="loginScreen">
    <div id="loginBox">
        <h2>ğŸ”’ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</h2>
        <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸" />
        <button id="loginButton">ë¡œê·¸ì¸</button>
        <p id="loginError" style="color: red; margin-top: 10px; display: none;">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</p>
    </div>
</div>
<h1 id="title">ğŸŒ¦ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´</h1>
<div class="controls">
    <form id="weatherForm" style="display:inline;">
        <select id="citySelect" required>
            <option value="">ë„ì‹œ ì„ íƒ</option>
        </select>
        <input type="submit" value="ê²€ìƒ‰" />
    </form>
    <button id="langToggle">English</button>
</div>
<div id="loading" style="display:none;">â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
<div id="forecastResult" class="forecast"></div>
<div id="map"></div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <div id="modalBody"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const API_KEY='66f62464dec4a29271b61021e3858e76';
let currentLang='kr', forecastRaw=null;

// âœ¨ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ëŒ€ì‹ , SHA-256 í•´ì‹œ ê°’ ì €ì¥
// ì›ë³¸ ë¹„ë°€ë²ˆí˜¸: '******'
// SHA-256 í•´ì‹œ ê°’ (ì†Œë¬¸ì): c0a216447d25642d911b306b43d3b664d6a742878c7722956f1400e99b054a8e
const CORRECT_HASH = 'c0a216447d25642d911b306b43d3b664d6a742878c7722956f1400e99b054a8e'; 

const cities=[
// ... (ë„ì‹œ ë°ì´í„° ìœ ì§€) ...
{id:1835848,name:"Seoul",name_kr:"ì„œìš¸",lat:37.5665,lon:126.9780},
{id:5128581,name:"New York",name_kr:"ë‰´ìš•",lat:40.7128,lon:-74.0060},
{id:2643743,name:"London",name_kr:"ëŸ°ë˜",lat:51.5074,lon:-0.1278},
{id:1850147,name:"Tokyo",name_kr:"ë„ì¿„",lat:35.6895,lon:139.6917},
{id:2950159,name:"Berlin",name_kr:"ë² ë¥¼ë¦°",lat:52.52,lon:13.405},
{id:2147714,name:"Sydney",name_kr:"ì‹œë“œë‹ˆ",lat:-33.8688,lon:151.2093},
{id:1880252,name:"Singapore",name_kr:"ì‹±ê°€í¬ë¥´",lat:1.3521,lon:103.8198},
{id:3435910,name:"Buenos Aires",name_kr:"ë¶€ì—ë…¸ìŠ¤ì•„ì´ë ˆìŠ¤",lat:-34.6037,lon:-58.3816},
{id:3448439,name:"SÃ£o Paulo",name_kr:"ìƒíŒŒìš¸ë£¨",lat:-23.5505,lon:-46.6333},
{id:360630,name:"Cairo",name_kr:"ì¹´ì´ë¡œ",lat:30.0444,lon:31.2357},
{id:3117735,name:"Madrid",name_kr:"ë§ˆë“œë¦¬ë“œ",lat:40.4168,lon:-3.7038},
{id:2988507,name:"Paris",name_kr:"íŒŒë¦¬",lat:48.8566,lon:2.3522},
{id:993800,name:"Johannesburg",name_kr:"ìš”í•˜ë„¤ìŠ¤ë²„ê·¸",lat:-26.2041,lon:28.0473},
{id:6167865,name:"Toronto",name_kr:"í† ë¡ í† ",lat:43.6532,lon:-79.3832},
{id:1816670,name:"Beijing",name_kr:"ë² ì´ì§•",lat:39.9042,lon:116.4074},
{id:2643123,name:"Manchester",name_kr:"ë§¨ì²´ìŠ¤í„°",lat:53.4808,lon:-2.2426},
{id:3451190,name:"Rio de Janeiro",name_kr:"ë¦¬ìš°ë°ìë„¤ì´ë£¨",lat:-22.9068,lon:-43.1729},
{id:2673730,name:"Stockholm",name_kr:"ìŠ¤í†¡í™€ë¦„",lat:59.3293,lon:18.0686}
];

const citySelect=document.getElementById('citySelect');
function fillCitySelect(){
    citySelect.innerHTML=`<option value="">${currentLang==='kr'?'ë„ì‹œ ì„ íƒ':'Select City'}</option>`;
    cities.forEach(c=>{
        const opt=document.createElement('option');
        opt.value=c.id;
        opt.textContent=currentLang==='kr'?c.name_kr:c.name;
        citySelect.appendChild(opt);
    });
}
fillCitySelect();

const map=L.map('map').setView([20,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:18 }).addTo(map);
const markers=[];
cities.forEach((city,i)=>{
    const marker=L.marker([city.lat,city.lon]).addTo(map);
    marker.bindTooltip(currentLang==='kr'?city.name_kr:city.name);
    marker.on('click',()=>fetchForecast(city.id));
    markers.push(marker);
});

document.getElementById('weatherForm').addEventListener('submit',e=>{
    e.preventDefault();
    fetchForecast(citySelect.value);
});

document.getElementById('langToggle').addEventListener('click',()=>{
    currentLang=currentLang==='kr'?'en':'kr';
    document.getElementById('title').textContent=currentLang==='kr'?'ğŸŒ¦ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´':'ğŸŒ¦ Major City 5-Day Weather Forecast';
    fillCitySelect();
    markers.forEach((m,i)=>m.bindTooltip(currentLang==='kr'?cities[i].name_kr:cities[i].name));
});

function fetchForecast(cityId){
    if(!cityId) return alert(currentLang==='kr'?'ë„ì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!':'Please select a city!');
    const loading=document.getElementById('loading');
    loading.style.display='block';
    fetch(`https://api.openweathermap.org/data/2.5/forecast?id=${cityId}&appid=${API_KEY}&units=metric&lang=${currentLang}`)
        .then(res=>res.json())
        .then(data=>{
            loading.style.display='none';
            if(data.cod==='200'){
                forecastRaw=data;
                showForecast(data);
                map.setView([data.city.coord.lat,data.city.coord.lon],7);
            }else{
                document.getElementById('forecastResult').innerHTML=`<p class="error">${currentLang==='kr'?'ë„ì‹œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.':'City data not found.'}</p>`;
            }
        })
        .catch(()=>{
            loading.style.display='none';
            document.getElementById('forecastResult').innerHTML=`<p class="error">${currentLang==='kr'?'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.':'An error occurred.'}</p>`;
        });
}

function mostFrequent(arr){ const count={}; arr.forEach(v=>count[v]=(count[v]||0)+1); return Object.keys(count).reduce((a,b)=>count[a]>count[b]?a:b); }

function showForecast(data){
    const daily={};
    data.list.forEach(item=>{
        const date=item.dt_txt.split(' ')[0];
        if(!daily[date]) daily[date]={ temps:[], feels:[], humid:[], wind:[], press:[], desc:[], icon:[], details:[] };
        daily[date].temps.push(item.main.temp);
        daily[date].feels.push(item.main.feels_like);
        daily[date].humid.push(item.main.humidity);
        daily[date].wind.push(item.wind.speed);
        daily[date].press.push(item.main.pressure);
        daily[date].desc.push(item.weather[0].description);
        daily[date].icon.push(item.weather[0].icon);
        daily[date].details.push(item);
    });

    const days=Object.keys(daily).slice(0,5);
    let html='';
    days.forEach(date=>{
        const d=daily[date];
        const avg=a=>a.reduce((x,y)=>x+y,0)/a.length;
        const maxT=Math.max(...d.temps).toFixed(1);
        const minT=Math.min(...d.temps).toFixed(1);
        const avgF=avg(d.feels).toFixed(1);
        const avgH=avg(d.humid).toFixed(0);
        const avgW=avg(d.wind).toFixed(1);
        const avgP=avg(d.press).toFixed(0);
        const desc=mostFrequent(d.desc);
        const icon=mostFrequent(d.icon);
        const dateObj=new Date(date);
        const dayNames=currentLang==='kr'?['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ']:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
        const dateStr=`${dateObj.getMonth()+1}/${dateObj.getDate()} (${dayNames[dateObj.getDay()]})`;

        html += `<div class="day" onclick="showDetails('${date}')">
            <h3>${dateStr}</h3>
            <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${desc}"><br>
            <strong>${minT}Â° / ${maxT}Â°C</strong>
            <p>${desc}</p>
            <p class="humidity">${currentLang==='kr'?'ì²´ê°':'Feels'}: ${avgF} â„ƒ</p>
            <p class="wind">${currentLang==='kr'?'í’ì†':'Wind'}: ${avgW} m/s</p>
            <p class="pressure">${currentLang==='kr'?'ê¸°ì••':'Pressure'}: ${avgP} hPa</p>
            <p>${currentLang==='kr'?'ìŠµë„':'Humidity'}: ${avgH}%</p>
        </div>`;
        
    });
    document.getElementById('forecastResult').innerHTML=html;
}

function showDetails(date){
    const modal=document.getElementById('detailModal'), body=document.getElementById('modalBody');
    const dayData=forecastRaw.list.filter(i=>i.dt_txt.startsWith(date));
    let html=`<h2>${date}</h2><table style="width:100%;text-align:center;"><tr><th>${currentLang==='kr'?'ì‹œê°„':'Time'}</th><th>${currentLang==='kr'?'ê¸°ì˜¨':'Temp'}</th><th>${currentLang==='kr'?'ì²´ê°':'Feels'}</th><th>${currentLang==='kr'?'ìŠµë„':'Humidity'}</th><th>${currentLang==='kr'?'í’ì†':'Wind'}</th><th>${currentLang==='kr'?'ê¸°ì••':'Pressure'}</th></tr>`;
    dayData.forEach(item=>{
        const t=item.dt_txt.split(' ')[1].slice(0,5);
        html+=`<tr><td>${t}</td><td>${item.main.temp}Â°C</td><td>${item.main.feels_like}Â°C</td><td>${item.main.humidity}%</td><td>${item.wind.speed} m/s</td><td>${item.main.pressure} hPa</td></tr>`;
    });
    html+='</table>';
    body.innerHTML=html;
    modal.style.display='flex';
}

document.querySelector('.modal-close').addEventListener('click',()=>{ document.getElementById('detailModal').style.display='none'; });
window.addEventListener('click',e=>{ if(e.target.id==='detailModal') e.target.style.display='none'; });

// ğŸ”‘ ìƒˆë¡œìš´ í•´ì‹± ë¡œì§ ğŸ”‘

// ArrayBufferë¥¼ 16ì§„ìˆ˜ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
function bufferToHex(buffer) {
    return Array.prototype.map.call(new Uint8Array(buffer), x => (('00' + x.toString(16))).slice(-2)).join('');
}

// SHA-256 í•´ì‹œ í•¨ìˆ˜ (ë¹„ë™ê¸°)
async function sha256(str) {
    const encoder = new TextEncoder();
    const data = encoder.encode(str);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    return bufferToHex(hashBuffer);
}

const loginScreen = document.getElementById('loginScreen');
const passwordInput = document.getElementById('passwordInput');
const loginButton = document.getElementById('loginButton');
const loginError = document.getElementById('loginError');

// ë¹„ë™ê¸° ë¡œê·¸ì¸ í™•ì¸ í•¨ìˆ˜ë¡œ ë³€ê²½
async function checkLogin(e) {
    if (e) e.preventDefault();
    const enteredPassword = passwordInput.value;
    
    // 1. ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ SHA-256ìœ¼ë¡œ í•´ì‹œ
    const enteredHash = await sha256(enteredPassword);
    
    // 2. í•´ì‹œ ê°’ì„ ë¯¸ë¦¬ ì €ì¥ëœ í•´ì‹œ ê°’ê³¼ ë¹„êµ
    if (enteredHash === CORRECT_HASH) {
        // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜: ë¡œê·¸ì¸ í™”ë©´ ìˆ¨ê¸°ê¸°
        loginScreen.style.display = 'none';
        loginError.style.display = 'none';
    } else {
        // ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜: ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        loginError.style.display = 'block';
        passwordInput.value = ''; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        passwordInput.focus();
    }
}

// ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
loginButton.addEventListener('click', checkLogin);

// Enter í‚¤ ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
passwordInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        checkLogin(e);
    }
});
</script>
</body>
</html>
