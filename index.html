<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ğŸŒ¦ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    background: #eef6f9;
    transition: background 0.3s;
  }
  h1 { text-align: center; }
  .controls {
    text-align: center;
    margin-bottom: 10px;
  }
  select, input[type=submit], button {
    font-size: 1rem;
    padding: 8px 12px;
    margin: 10px 5px;
    border-radius: 8px;
    border: 1px solid #ccc;
    background: white;
    cursor: pointer;
    transition: background 0.2s;
  }
  select:hover, input[type=submit]:hover, button:hover {
    background: #dff4ff;
  }
  #map {
    height: 500px;
    margin-top: 20px;
    border-radius: 10px;
    box-shadow: 0 3px 7px rgba(0,0,0,0.2);
  }
  .forecast {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
  }
  .day {
    background: white;
    border-radius: 12px;
    box-shadow: 0 3px 7px rgba(0,0,0,0.1);
    margin: 10px;
    padding: 15px;
    width: 140px;
    text-align: center;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.5s forwards;
  }
  .day:nth-child(even) { animation-delay: 0.2s; }
  .day h3 { margin: 0 0 8px 0; }
  .day strong { color: #e63946; font-size: 1.2rem; }
  .humidity { color: #1d3557; font-weight: 600; margin: 6px 0 0 0; }
  .error { color: red; text-align: center; margin-top: 20px; }

  #loading {
    text-align: center;
    font-size: 1.1rem;
    color: #333;
    margin-top: 20px;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 600px) {
    .day {
      width: 100%;
      max-width: 300px;
    }
  }
</style>
</head>

<body>
  <h1 id="title">ğŸŒ¦ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´</h1>

  <div class="controls">
    <form id="weatherForm" style="display:inline;">
      <select id="citySelect" required>
        <option value="">ë„ì‹œ ì„ íƒ</option>
      <option value="1835848">Seoul, KR</option>
      <option value="5128581">New York, US</option>
      <option value="2643743">London, GB</option>
      <option value="1850147">Tokyo, JP</option>
      <option value="2950159">Berlin, DE</option>
      <option value="2147714">Sydney, AU</option>
      <option value="1880252">Singapore, SG</option>
      <option value="3435910">Buenos Aires, AR</option>
      <option value="3448439">SÃ£o Paulo, BR</option>
      <option value="360630">Cairo, EG</option>
      <option value="3117735">Madrid, ES</option>
      <option value="2988507">Paris, FR</option>
      <option value="993800">Johannesburg, ZA</option>
      <option value="6167865">Toronto, CA</option>
      <option value="1816670">Beijing, CN</option>
      <option value="2643123">Manchester, GB</option>
      <option value="3451190">Rio de Janeiro, BR</option>
      <option value="2673730">Stockholm, SE</option>

      </select>
      <input type="submit" value="ê²€ìƒ‰" />
    </form>
    <button id="langToggle">English</button>
  </div>

  <div id="loading" style="display:none;">â³ ë‚ ì”¨ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="forecastResult" class="forecast"></div>
  <div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const API_KEY = '66f62464dec4a29271b61021e3858e76';
let currentLang = 'kr'; // ê¸°ë³¸ í•œêµ­ì–´

const cities = [
  { id: 1835848, name: "Seoul", lat: 37.5665, lon: 126.9780 },
  { id: 5128581, name: "New York", lat: 40.7128, lon: -74.0060 },
  { id: 2643743, name: "London", lat: 51.5074, lon: -0.1278 },
  { id: 1850147, name: "Tokyo", lat: 35.6895, lon: 139.6917 },
  { id: 2950159, name: "Berlin", lat: 52.52, lon: 13.405 },
  { id: 2147714, name: "Sydney", lat: -33.8688, lon: 151.2093 },
  { id: 1880252, name: "Singapore", lat: 1.3521, lon: 103.8198 },
  { id: 3435910, name: "Buenos Aires", lat: -34.6037, lon: -58.3816 },
  { id: 3448439, name: "SÃ£o Paulo", lat: -23.5505, lon: -46.6333 },
  { id: 360630, name: "Cairo", lat: 30.0444, lon: 31.2357 },
  { id: 3117735, name: "Madrid", lat: 40.4168, lon: -3.7038 },
  { id: 2988507, name: "Paris", lat: 48.8566, lon: 2.3522 },
  { id: 993800, name: "Johannesburg", lat: -26.2041, lon: 28.0473 },
  { id: 6167865, name: "Toronto", lat: 43.6532, lon: -79.3832 },
  { id: 1816670, name: "Beijing", lat: 39.9042, lon: 116.4074 },
  { id: 2643123, name: "Manchester", lat: 53.4808, lon: -2.2426 },
  { id: 3451190, name: "Rio de Janeiro", lat: -22.9068, lon: -43.1729 },
  { id: 2673730, name: "Stockholm", lat: 59.3293, lon: 18.0686 }

];

// ì§€ë„ ì´ˆê¸°í™”
const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);

// ë§ˆì»¤ í‘œì‹œ
cities.forEach(city => {
  const marker = L.marker([city.lat, city.lon]).addTo(map);
  marker.bindTooltip(city.name);
  marker.on('click', () => fetchForecast(city.id));
});

document.getElementById('weatherForm').addEventListener('submit', e => {
  e.preventDefault();
  const cityId = document.getElementById('citySelect').value;
  if (!cityId) return alert(currentLang === 'kr' ? 'ë„ì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!' : 'Please select a city!');
  fetchForecast(cityId);
});

document.getElementById('langToggle').addEventListener('click', () => {
  currentLang = currentLang === 'kr' ? 'en' : 'kr';
  document.getElementById('langToggle').textContent = currentLang === 'kr' ? 'English' : 'í•œêµ­ì–´';
  document.getElementById('title').textContent = currentLang === 'kr'
    ? 'ğŸŒ¦ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´'
    : 'ğŸŒ¦ 5-Day Weather Forecast for Major Cities';
});

function fetchForecast(cityId) {
  const loading = document.getElementById('loading');
  const result = document.getElementById('forecastResult');
  result.innerHTML = '';
  loading.style.display = 'block';

  const url = `https://api.openweathermap.org/data/2.5/forecast?id=${cityId}&appid=${API_KEY}&units=metric&lang=${currentLang}`;
  fetch(url)
    .then(res => res.json())
    .then(data => {
      loading.style.display = 'none';
      if (data.cod === "200") {
        showForecast(data);
        map.setView([data.city.coord.lat, data.city.coord.lon], 6);
        const icon = data.list[0].weather[0].icon;
        const desc = data.list[0].weather[0].description;
        const temp = data.list[0].main.temp.toFixed(1);
        L.popup()
          .setLatLng([data.city.coord.lat, data.city.coord.lon])
          .setContent(`
            <h3>${data.city.name}</h3>
            <img src="https://openweathermap.org/img/wn/${icon}.png">
            <p><strong>${temp} â„ƒ</strong><br>${desc}</p>
          `)
          .openOn(map);
      } else {
        result.innerHTML = `<p class="error">${currentLang === 'kr' ? 'ë„ì‹œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' : 'City data not found.'}</p>`;
      }
    })
    .catch(err => {
      console.error(err);
      loading.style.display = 'none';
      result.innerHTML = `<p class="error">${currentLang === 'kr' ? 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' : 'An error occurred.'}</p>`;
    });
}

function showForecast(data){
  const daily = {};
  data.list.forEach(item => {
    const date = item.dt_txt.split(' ')[0];
    if(!daily[date]) daily[date] = { temps: [], humidities: [], descriptions: [], icons: [] };
    daily[date].temps.push(item.main.temp);
    daily[date].humidities.push(item.main.humidity);
    daily[date].descriptions.push(item.weather[0].description);
    daily[date].icons.push(item.weather[0].icon);
  });
  
  const days = Object.keys(daily).slice(0,5);
  let html = '';
  days.forEach(date => {
    const day = daily[date];
    const avgTemp = (day.temps.reduce((a,b) => a+b, 0) / day.temps.length).toFixed(1);
    const avgHumidity = (day.humidities.reduce((a,b) => a+b, 0) / day.humidities.length).toFixed(0);
    const desc = mostFrequent(day.descriptions);
    const icon = mostFrequent(day.icons);
    const dateObj = new Date(date);
    const dayNames = currentLang === 'kr' ? ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '] : ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const dateStr = `${dateObj.getMonth()+1}/${dateObj.getDate()} (${dayNames[dateObj.getDay()]})`;
    
    html += `
      <div class="day">
        <h3>${dateStr}</h3>
        <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${desc}">
        <strong>${avgTemp} â„ƒ</strong>
        <p class="humidity">${currentLang === 'kr' ? 'ìŠµë„' : 'Humidity'}: ${avgHumidity}%</p>
        <p>${desc}</p>
      </div>
    `;
  });
  document.getElementById('forecastResult').innerHTML = html;
}

function mostFrequent(arr){
  const count = {};
  arr.forEach(v => count[v] = (count[v] || 0) + 1);
  return Object.keys(count).reduce((a,b) => count[a] > count[b] ? a : b);
}
</script>
</body>
</html>




