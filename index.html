<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ğŸŒ¦ ì „ ì„¸ê³„ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    background: linear-gradient(to bottom, #e8f7ff, #f7fbff);
    transition: background 0.5s;
  }
  h1 { text-align: center; }
  .controls { text-align: center; margin-bottom: 10px; }
  select, input[type=submit], button {
    font-size: 1rem; padding: 8px 12px; margin: 10px 5px;
    border-radius: 8px; border: 1px solid #ccc; background: white;
    cursor: pointer; transition: background 0.2s;
  }
  select:hover, input[type=submit]:hover, button:hover { background: #dff4ff; }
  #map {
    height: 480px; margin-top: 20px; border-radius: 10px;
    box-shadow: 0 3px 7px rgba(0,0,0,0.2);
  }
  .forecast {
    margin-top: 25px; display: flex; justify-content: center; flex-wrap: wrap;
  }
  .day {
    background: white; border-radius: 12px; box-shadow: 0 3px 7px rgba(0,0,0,0.1);
    margin: 10px; padding: 15px; width: 200px; text-align: center;
    opacity: 0; transform: translateY(20px); animation: fadeInUp 0.6s forwards;
  }
  .day h3 { margin: 0 0 6px 0; }
  .day strong { color: #e63946; font-size: 1.2rem; }
  .humidity, .wind, .pressure { font-size: 0.9rem; color: #1d3557; margin: 4px 0; }
  .error { color: red; text-align: center; margin-top: 20px; }
  #loading { text-align: center; font-size: 1.1rem; color: #333; margin-top: 20px; }
  @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
  @media (max-width: 600px) {
    .day { width: 100%; max-width: 280px; }
  }
</style>
</head>

<body>
  <h1 id="title">ğŸŒ¦ ì „ ì„¸ê³„ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´</h1>
  <div class="controls">
    <form id="weatherForm" style="display:inline;">
      <select id="citySelect" required>
        <option value="">ë„ì‹œ ì„ íƒ</option>
      </select>
      <input type="submit" value="ê²€ìƒ‰" />
    </form>
    <button id="langToggle">English</button>
  </div>

  <div id="loading" style="display:none;">â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="forecastResult" class="forecast"></div>
  <div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const API_KEY = '66f62464dec4a29271b61021e3858e76';
let currentLang = 'kr';

const cities = [
  { id: 1835848, name: "Seoul", lat: 37.5665, lon: 126.9780 },
  { id: 5128581, name: "New York", lat: 40.7128, lon: -74.0060 },
  { id: 2643743, name: "London", lat: 51.5074, lon: -0.1278 },
  { id: 1850147, name: "Tokyo", lat: 35.6895, lon: 139.6917 },
  { id: 2950159, name: "Berlin", lat: 52.52, lon: 13.405 },
  { id: 2147714, name: "Sydney", lat: -33.8688, lon: 151.2093 },
  { id: 1880252, name: "Singapore", lat: 1.3521, lon: 103.8198 },
  { id: 3435910, name: "Buenos Aires", lat: -34.6037, lon: -58.3816 },
  { id: 3448439, name: "SÃ£o Paulo", lat: -23.5505, lon: -46.6333 },
  { id: 360630, name: "Cairo", lat: 30.0444, lon: 31.2357 },
  { id: 3117735, name: "Madrid", lat: 40.4168, lon: -3.7038 },
  { id: 2988507, name: "Paris", lat: 48.8566, lon: 2.3522 },
  { id: 993800, name: "Johannesburg", lat: -26.2041, lon: 28.0473 },
  { id: 6167865, name: "Toronto", lat: 43.6532, lon: -79.3832 },
  { id: 1816670, name: "Beijing", lat: 39.9042, lon: 116.4074 },
  { id: 2643123, name: "Manchester", lat: 53.4808, lon: -2.2426 },
  { id: 3451190, name: "Rio de Janeiro", lat: -22.9068, lon: -43.1729 },
  { id: 2673730, name: "Stockholm", lat: 59.3293, lon: 18.0686 }
];

// ë„ì‹œ ëª©ë¡ select ì±„ìš°ê¸°
const citySelect = document.getElementById('citySelect');
cities.forEach(c => {
  const opt = document.createElement('option');
  opt.value = c.id;
  opt.textContent = `${c.name}`;
  citySelect.appendChild(opt);
});

// ì§€ë„ ì´ˆê¸°í™”
const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);

cities.forEach(city => {
  const marker = L.marker([city.lat, city.lon]).addTo(map);
  marker.bindTooltip(city.name);
  marker.on('click', () => fetchForecast(city.id));
});

document.getElementById('weatherForm').addEventListener('submit', e => {
  e.preventDefault();
  const cityId = citySelect.value;
  if (!cityId) return alert(currentLang === 'kr' ? 'ë„ì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!' : 'Please select a city!');
  fetchForecast(cityId);
});

document.getElementById('langToggle').addEventListener('click', () => {
  currentLang = currentLang === 'kr' ? 'en' : 'kr';
  document.getElementById('langToggle').textContent = currentLang === 'kr' ? 'English' : 'í•œêµ­ì–´';
  document.getElementById('title').textContent = currentLang === 'kr'
    ? 'ğŸŒ¦ ì „ ì„¸ê³„ ì£¼ìš” ë„ì‹œ 5ì¼ ë‚ ì”¨ ì˜ˆë³´'
    : 'ğŸŒ¦ Global 5-Day Weather Forecast';
});

function fetchForecast(cityId) {
  const loading = document.getElementById('loading');
  const result = document.getElementById('forecastResult');
  result.innerHTML = '';
  loading.style.display = 'block';

  fetch(`https://api.openweathermap.org/data/2.5/forecast?id=${cityId}&appid=${API_KEY}&units=metric&lang=${currentLang}`)
    .then(res => res.json())
    .then(data => {
      loading.style.display = 'none';
      if (data.cod === "200") {
        showForecast(data);
        map.setView([data.city.coord.lat, data.city.coord.lon], 7);
      } else {
        result.innerHTML = `<p class="error">${currentLang === 'kr' ? 'ë„ì‹œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' : 'City data not found.'}</p>`;
      }
    })
    .catch(() => {
      loading.style.display = 'none';
      result.innerHTML = `<p class="error">${currentLang === 'kr' ? 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' : 'An error occurred.'}</p>`;
    });
}

function showForecast(data) {
  const daily = {};
  data.list.forEach(item => {
    const date = item.dt_txt.split(' ')[0];
    if(!daily[date]) daily[date] = { temps: [], feels: [], humid: [], wind: [], press: [], desc: [], icon: [] };
    daily[date].temps.push(item.main.temp);
    daily[date].feels.push(item.main.feels_like);
    daily[date].humid.push(item.main.humidity);
    daily[date].wind.push(item.wind.speed);
    daily[date].press.push(item.main.pressure);
    daily[date].desc.push(item.weather[0].description);
    daily[date].icon.push(item.weather[0].icon);
  });

  const days = Object.keys(daily).slice(0,5);
  let html = '';
  days.forEach(date => {
    const d = daily[date];
    const avg = arr => (arr.reduce((a,b)=>a+b,0)/arr.length);
    const maxT = Math.max(...d.temps).toFixed(1);
    const minT = Math.min(...d.temps).toFixed(1);
    const avgH = avg(d.humid).toFixed(0);
    const avgW = avg(d.wind).toFixed(1);
    const avgP = avg(d.press).toFixed(0);
    const avgF = avg(d.feels).toFixed(1);
    const desc = mostFrequent(d.desc);
    const icon = mostFrequent(d.icon);
    const dateObj = new Date(date);
    const dayNames = currentLang === 'kr' ? ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '] : ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const dateStr = `${dateObj.getMonth()+1}/${dateObj.getDate()} (${dayNames[dateObj.getDay()]})`;
    html += `
      <div class="day">
        <h3>${dateStr}</h3>
        <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${desc}">
        <strong>${minT}Â° / ${maxT}Â°C</strong>
        <p>${desc}</p>
        <p class="humidity">${currentLang === 'kr' ? 'ì²´ê°' : 'Feels'}: ${avgF} â„ƒ</p>
        <p class="wind">${currentLang === 'kr' ? 'í’ì†' : 'Wind'}: ${avgW} m/s</p>
        <p class="pressure">${currentLang === 'kr' ? 'ê¸°ì••' : 'Pressure'}: ${avgP} hPa</p>
        <p>${currentLang === 'kr' ? 'ìŠµë„' : 'Humidity'}: ${avgH}%</p>
      </div>`;
  });
  document.getElementById('forecastResult').innerHTML = html;
}

function mostFrequent(arr) {
  const count = {};
  arr.forEach(v => count[v] = (count[v] || 0) + 1);
  return Object.keys(count).reduce((a,b)=>count[a]>count[b]?a:b);
}
</script>
</body>
</html>
